<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pwc.pwcesg.backoffice.contents.mapper.ContentInfoMapper">

  <!-- 콘텐츠정보 목록 조회 -->
  <select id="selectContentList2" parameterType="camelcasemap" resultType="camelcasemap">
    SELECT
    SCI.CONT_UID /* 콘텐츠채번 */
    , SCI.CONT_UNO /* 콘텐츠고유번호 */
    , SCI.CONT_KIND_CD /* 콘텐츠종류코드 */
    , fnCommCdNm('CONT_KIND_CD', CONT_KIND_CD) AS CONT_KIND_CD_NM /* 콘텐츠종류코드명 */
    , SCI.CONT_RMTHD_CD /* 콘텐츠등록방식코드 */
    , fnCommCdNm('CONT_RMTHD_CD', CONT_RMTHD_CD) AS CONT_RMTHD_CD_NM /* 콘텐츠등록방식코드명 */
    , SCI.CONT_NM /* 콘텐츠명 */
    , SCI.PBLCN_DTE /* 발행일자 */
    , SCI.PBLCN_YY /* 발행YY */
    , SCI.PBLCN_MM /* 발행MM */
    , SCI.PBLCN_DD /* 발행DD */
    , SCI.DMSTC_YN /* 국내여부 */
    , CASE SCI.DMSTC_YN
    WHEN 'Y' THEN '국내'
    WHEN 'N' THEN '해외'
    END AS DMSTC_YN_NM /* 국내여부명 */
    , SCI.SPLY_LANG_CD /* 제공언어코드 */
    , fnCommCdNm('SPLY_LANG_CD', SPLY_LANG_CD) AS SPLY_LANG_CD_NM /* 제공언어코드명 */
    , SCI.CONT_TP_LCLSF_CD /* 콘텐츠유형대분류코드 */
    , fnCommCdNm('CONT_TP_LCLSF_CD', CONT_TP_LCLSF_CD) AS CONT_TP_LCLSF_CD_NM /* 콘텐츠유형대분류코드명 */
    , SCI.CONT_TP_MCLSF_CD /* 콘텐츠유형중분류코드 */
    , fnCommCdNm('CONT_TP_MCLSF_CD', CONT_TP_MCLSF_CD) AS CONT_TP_MCLSF_CD_NM /* 콘텐츠유형중분류코드명 */
    , SCI.TASK_CLSF_CD /* 업무분류코드 */
    , fnCommCdNm('TASK_CLSF_CD', TASK_CLSF_CD) AS TASK_CLSF_CD_NM /* 업무분류코드명 */
    , SCI.TPIC_MNU_CD /* 토픽메뉴코드(주제분류) */
    , fnCommCdNm('TPIC_MNU_CD', SCI.TPIC_MNU_CD)           AS TPIC_MNU_CD_NM /* 토픽메뉴명 */
    , SCI.USE_YN /* 사용여부 */
    , SCI.DP_YN /* 전시여부 */
    , SCI.DP_TP_CD /* 전시유형코드 */
    , fnCommCdNm('DP_TP_CD', DP_TP_CD) AS DP_TP_CD_NM /* 전시유형코드명 */
    , SCI.DP_STT_DT /* 전시시작일 */
    , SCI.DP_END_DT /* 전시종료일 */
    , SCI.PIRD_STNG_USE_YN /* 기간설정사용여부 */
    , SCI.DWNLD_PSBLTY_YN /* 다운로드가능여부 */
    , CASE SCI.DWNLD_PSBLTY_YN
    WHEN 'Y' THEN '가능'
    WHEN 'N' THEN '불가'
    END AS DWNLD_PSBLTY_YN_NM /* 국내여부명 */
    , SCI.SRCH_PSBLTY_YN /* 검색가능여부 */
    , CASE SCI.SRCH_PSBLTY_YN
    WHEN 'Y' THEN '가능'
    WHEN 'N' THEN '불가'
    END AS SRCH_PSBLTY_YN_NM /* 국내여부명 */
    , SCI.CONT_SUMRY /* 콘텐츠요약 */
    , SCI.CONT_ST_CD /* 콘텐츠상태코드 */
    , SCI.KWRD_ARRY /* 키워드배열 */
    , SCI.RLS_TGT_CD_ARRY /* 공개대상코드배열 */
    , SCI.SRC_UID /* 출처채번 */
    , (SELECT SRC_NM FROM ST_SRC_INFO WHERE SRC_UID = SCI.SRC_UID) AS SRC_NM /* 출처명 */
    , SCI.ATAC_FILE_UID /* 첨부파일채번 */
    , SCI.FST_INS_DT /* 최초등록일 */
    , SCI.FST_INS_ID /* 최초등록아이디 */
    , SCI.LST_UPD_DT /* 최종수정일 */
    , SCI.LST_UPD_ID /* 최종수정아이디 */
    , (SELECT GROUP_CONCAT(fnCommCdNm('RLS_TGT_CD', RLS_TGT_CD))
    FROM ST_CONT_RLS_TGT_INFO
    WHERE CONT_UID = SCI.CONT_UID
    GROUP BY CONT_UID)                                  AS RLS_TGT_CD_NMS       /* 공개대상코드명 그룹핑 */
    FROM ST_CONT_INFO SCI /* 콘텐츠정보 */
    <where>
      <!-- 검색조건 : 등록일/수정일 -->
      <choose>
        <!-- 등록일 -->
        <when test="schJoinType.equals('01')">
          <if test="schStrtDate != null and !schStrtDate.equals('')">
            AND SCI.FST_INS_DT <![CDATA[>=]]> #{schStrtDate}
          </if>
          <if test="schEndDate != null and !schEndDate.equals('')">
            AND SCI.FST_INS_DT <![CDATA[<=]]> #{schEndDate}
          </if>
        </when>
        <!-- 수정일 -->
        <when test="schJoinType.equals('02')">
          <if test="schStrtDate != null and !schStrtDate.equals('')">
            AND SCI.LST_UPD_DT <![CDATA[>=]]> #{schStrtDate}
          </if>
          <if test="schEndDate != null and !schEndDate.equals('')">
            AND SCI.LST_UPD_DT <![CDATA[<=]]> #{schEndDate} /* 탈퇴승인일: 조회종료일 */
          </if>
        </when>
        <!-- 기간설정 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 등록자/수정자 -->
      <choose>
        <!-- 등록자 -->
        <when test="schOprtOpt.equals('01')">
          <if test="schOprtWrd != null and !schOprtWrd.equals('')">
            AND SCI.FST_INS_ID IN (
            SELECT MBR_UID
            FROM MB_MBR_INFO
            WHERE MBR_NM LIKE CONCAT(#{schOprtWrd}, '%')
            )
          </if>
        </when>
        <!-- 수정자 -->
        <when test="schOprtOpt.equals('02')">
          <if test="schOprtWrd != null and !schOprtWrd.equals('')">
            AND SCI.LST_UPD_ID IN (
            SELECT MBR_UID
            FROM MB_MBR_INFO
            WHERE MBR_NM LIKE CONCAT(#{schOprtWrd}, '%')
            )
          </if>
        </when>
        <!-- 조건없음 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 등록상태 -->
      <if test="schUseYnOpt != null and !schUseYnOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_ST_CD <![CDATA[=]]> #{schAskStRdo}
      </if>

      <!-- 검색조건 : 콘텐츠명/번호 -->
      <choose>
        <!-- 콘텐츠명 -->
        <when test="schContentOpt.equals('01')">
          <if test="schContentWrd != null and !schContentWrd.equals('')">
            AND SCI.CONT_NM LIKE CONCAT(#{schContentWrd}, '%')
          </if>
        </when>
        <!-- 콘텐츠번호 -->
        <when test="schContentOpt.equals('02')">
          <if test="schContentWrd != null and !schContentWrd.equals('')">
            AND SCI.CONT_UNO LIKE CONCAT(#{schContentWrd}, '%')
          </if>
        </when>
        <!-- 조건없음 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 콘텐츠종류 -->
      <if test="schContKindOpt != null and !schContKindOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_KIND_CD <![CDATA[=]]> #{schContKindOpt}
      </if>

      <!-- 검색조건 : 콘텐츠등록방식 -->
      <if test="schContRmthdOpt != null and !schContRmthdOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_RMTHD_CD <![CDATA[=]]> #{schContRmthdOpt}
      </if>

      <!-- 검색조건 : 출처명/번호 -->
      <choose>
        <!-- 출처명 -->
        <when test="schSrcOpt.equals('01')">
          <if test="schSrcWrd != null and !schSrcWrd.equals('')">
            AND SCI.SRC_UID IN (
            SELECT SRC_UID
            FROM ST_SRC_INFO
            WHERE SRC_NM LIKE CONCAT(#{schSrcWrd}, '%')
            )
          </if>
        </when>
        <!-- 출처번호 -->
        <when test="schSrcOpt.equals('02')">
          <if test="schSrcWrd != null and !schSrcWrd.equals('')">
            AND SCI.SRC_UID IN (
            SELECT SRC_UID
            FROM ST_SRC_INFO
            WHERE SRC_UNO LIKE CONCAT(#{schSrcWrd}, '%')
            )
          </if>
        </when>
        <!-- 조건없음 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 국내여부 -->
      <if test="schDmstcChk != null and !schDmstcChk.equalsIgnoreCase('ALL')">
        AND SCI.DMSTC_YN <![CDATA[=]]> #{schDmstcChk}
      </if>

      <!-- 검색조건 : 제공언어 -->
      <if test="schSplyLangOpt != null and !schSplyLangOpt.equalsIgnoreCase('ALL')">
        AND SCI.SPLY_LANG_CD <![CDATA[=]]> #{schSplyLangOpt}
      </if>

      <!-- 검색조건 : 유형대분류 -->
      <if test="schContTpLclsfOpt != null and !schContTpLclsfOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_TP_LCLSF_CD <![CDATA[=]]> #{schContTpLclsfOpt}
      </if>

      <!-- 검색조건 : 유형중분류 -->
      <if test="schContTpMclsfOpt != null and !schContTpMclsfOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_TP_MCLSF_CD <![CDATA[=]]> #{schContTpMclsfOpt}
      </if>

      <!-- 검색조건 : 업무 분류 -->
      <if test="schTaskClsfOpt != null and !schTaskClsfOpt.equalsIgnoreCase('ALL')">
        AND SCI.TASK_CLSF_CD <![CDATA[=]]> #{schTaskClsfOpt}
      </if>

      <!-- 검색조건 : 주제 분류 - 보류!! -->

      <!-- 검색조건 : 전시유형 -->
      <if test="schDpTpRdo != null and !schDpTpRdo.equalsIgnoreCase('ALL')">
        AND SCI.DP_TP_CD <![CDATA[=]]> #{schDpTpRdo}
      </if>

      <!-- 검색조건 : 일부공개대상 -->
      <if test="schRlsTgtChk != null and !schRlsTgtChk.equals('')">
        AND SCI.CONT_UID IN ( SELECT CONT_UID FROM ST_CONT_RLS_TGT_INFO WHERE RLS_TGT_CD IN
        <foreach item="rlsTgtCd" index="index" collection="rlsTgtCdList" separator="," open="("
          close=")">
          #{rlsTgtCd}
        </foreach>
        )
      </if>

      <!-- 검색조건 : 다운로드가능여부 -->
      <if test="schDwnldPsbltyRdo != null and !schDwnldPsbltyRdo.equalsIgnoreCase('ALL')">
        AND SCI.DWNLD_PSBLTY_YN <![CDATA[=]]> #{schDwnldPsbltyRdo}
      </if>

      <!-- 검색조건 : 검색가능여부 -->
      <if test="schSrchPsbltyRdo != null and !schSrchPsbltyRdo.equalsIgnoreCase('ALL')">
        AND SCI.SRCH_PSBLTY_YN <![CDATA[=]]> #{schSrchPsbltyRdo}
      </if>

      <!-- 검색조건 : ESG 토픽 (메뉴) -->
      <if test="schTpicMnuOpt != null and !schTpicMnuOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_UID IN (
        SELECT CONT_UID
        FROM DP_CONT_TPIC_INFO
        WHERE TPIC_UID IN (
        SELECT TPIC_UID
        FROM DP_TPIC_INFO
        WHERE TPIC_MNU_CD <![CDATA[=]]> #{schTpicMnuOpt}

        <!-- 검색조건 : ESG 토픽 (토픽명) -->
        <if test="schTpicNmOpt != null and !schTpicNmOpt.equalsIgnoreCase('ALL')">
          AND TPIC_NM <![CDATA[=]]> #{schTpicNmOpt}
        </if>
        )
        )
      </if>

    </where>
    ORDER BY SCI.LST_UPD_DT DESC
  </select>

  <!-- 출처정보 목록 조회 -->
  <select id="selectSrcList2" parameterType="camelcasemap" resultType="camelcasemap">
    SELECT
    SSI.SRC_UID /* 출처채번 */
    , SSI.SRC_UNO /* 출처고유번호 */
    , SSI.SRC_NM /* 출처명 */
    , SSI.DMSTC_YN /* 국내여부 */
    , CASE SSI.DMSTC_YN
    WHEN 'Y' THEN '국내'
    WHEN 'N' THEN '해외'
    END AS DMSTC_YN_NM /* 국내여부명 */
    , SSI.FST_INS_DT /* 최초등록일 */
    , SSI.FST_INS_ID /* 최초등록아이디 */
    , SSI.LST_UPD_DT /* 최종수정일 */
    , SSI.LST_UPD_ID /* 최종수정아이디 */
    , (SELECT COUNT(1) FROM ST_CONT_INFO SCI WHERE SCI.SRC_UID= SSI.SRC_UID) AS CONT_TOT_CNT /*
    콘텐츠전체건수 */
    , (SELECT COUNT(1) FROM ST_CONT_INFO SCI WHERE SCI.SRC_UID= SSI.SRC_UID AND
    SCI.CONT_KIND_CD='10') AS CONT_DOC_CNT /* 콘텐츠문서건수 */
    , (SELECT COUNT(1) FROM ST_CONT_INFO SCI WHERE SCI.SRC_UID= SSI.SRC_UID AND
    SCI.CONT_KIND_CD='20') AS CONT_MOV_CNT /* 콘텐츠영상건수 */
    FROM ST_SRC_INFO SSI /* 출처정보 */
    <where>
      <!-- 검색조건 : 등록일/수정일 -->
      <choose>
        <!-- 등록일 -->
        <when test="schJoinType.equals('01')">
          <if test="schStrtDate != null and !schStrtDate.equals('')">
            AND SSI.FST_INS_DT <![CDATA[>=]]> #{schStrtDate}
          </if>
          <if test="schEndDate != null and !schEndDate.equals('')">
            AND SSI.FST_INS_DT <![CDATA[<=]]> #{schEndDate}
          </if>
        </when>
        <!-- 수정일 -->
        <when test="schJoinType.equals('02')">
          <if test="schStrtDate != null and !schStrtDate.equals('')">
            AND SSI.LST_UPD_DT <![CDATA[>=]]> #{schStrtDate}
          </if>
          <if test="schEndDate != null and !schEndDate.equals('')">
            AND SSI.LST_UPD_DT <![CDATA[<=]]> #{schEndDate} /* 탈퇴승인일: 조회종료일 */
          </if>
        </when>
        <!-- 기간설정 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 등록자/수정자 -->
      <choose>
        <!-- 등록자 -->
        <when test="schOprtOpt.equals('01')">
          <if test="schOprtWrd != null and !schOprtWrd.equals('')">
            AND SSI.FST_INS_ID IN (
            SELECT MBR_UID
            FROM MB_MBR_INFO
            WHERE MBR_NM LIKE CONCAT(#{schOprtWrd}, '%')
            )
          </if>
        </when>
        <!-- 수정자 -->
        <when test="schOprtOpt.equals('02')">
          <if test="schOprtWrd != null and !schOprtWrd.equals('')">
            AND SSI.LST_UPD_ID IN (
            SELECT MBR_UID
            FROM MB_MBR_INFO
            WHERE MBR_NM LIKE CONCAT(#{schOprtWrd}, '%')
            )
          </if>
        </when>
        <!-- 조건없음 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 출처명/번호 -->
      <choose>
        <!-- 출처명 -->
        <when test="schSrcOpt.equals('01')">
          <if test="schSrcWrd != null and !schSrcWrd.equals('')">
            AND SSI.SRC_NM LIKE CONCAT(#{schSrcWrd}, '%')
          </if>
        </when>
        <!-- 출처번호 -->
        <when test="schSrcOpt.equals('02')">
          <if test="schSrcWrd != null and !schSrcWrd.equals('')">
            AND SSI.SRC_UNO LIKE CONCAT(#{schSrcWrd}, '%')
          </if>
        </when>
        <!-- 조건없음 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 국내/해외 -->
      <if test="schDmstcChk != null and !schDmstcChk.equalsIgnoreCase('ALL')">
        AND SSI.DMSTC_YN = #{schDmstcChk} /* 국내여부 */
      </if>
    </where>
    ORDER BY SSI.FST_INS_DT DESC
  </select>

  <!-- 출처정보 상세 조회 -->
  <select id="selectSrcView2" parameterType="camelcasemap" resultType="camelcasemap">
    SELECT SSI.SRC_UID /* 출처채번 */
         , SSI.SRC_UNO /* 출처고유번호 */
         , SSI.SRC_NM /* 출처명 */
         , SSI.DMSTC_YN /* 국내여부 */
         , SSI.FST_INS_DT /* 최초등록일 */
         , SSI.FST_INS_ID /* 최초등록아이디 */
         , SSI.LST_UPD_DT /* 최종수정일 */
         , SSI.LST_UPD_ID /* 최종수정아이디 */
    FROM ST_SRC_INFO SSI /* 출처정보 */
    WHERE SSI.SRC_UID = #{srcUid} /* 출처채번 */
  </select>

  <!-- 출처정보 등록 -->
  <insert id="insertSrcInfo2" parameterType="camelcasemap">
    INSERT INTO ST_SRC_INFO
    ( SRC_UID /* 출처채번 */
    , SRC_UNO /* 출처고유번호 */
    , SRC_NM /* 출처명 */
    , DMSTC_YN /* 국내여부 */
    , FST_INS_DT /* 최초등록일 */
    , FST_INS_ID /* 최초등록아이디 */
    , LST_UPD_DT /* 최종수정일 */
    , LST_UPD_ID /* 최종수정아이디 */
    )
    VALUES ( NEXTVAL('ST_SRC_INFO_SQ01')
           , (CASE
                WHEN #{dmstcYn} = 'Y'
                  THEN CONCAT('SK', LPAD(NEXTVAL('ST_SRC_INFO_SQ02'), 5, '0'))
                ELSE CONCAT('SF', LPAD(NEXTVAL('ST_SRC_INFO_SQ02'), 5, '0'))
        END)
           , #{srcNmByUpsertPop}
           , #{dmstcYn}
           , CURRENT_TIMESTAMP /* 최초등록일 */
           , 'ADMIN' /* 최초등록아이디 fstInsId */
           , CURRENT_TIMESTAMP /* 최종수정일 */
           , 'ADMIN' /* 최종수정아이디 lstUpdId */
           )
  </insert>

  <!-- 출처정보 수정 -->
  <update id="updateSrcInfo2" parameterType="hashMap">
    UPDATE ST_SRC_INFO
    SET SRC_NM     = #{srcNmByUpsertPop}
      , DMSTC_YN   = #{dmstcYn}
      , LST_UPD_DT = CURRENT_TIMESTAMP /* 최종수정일 */
      , LST_UPD_ID = 'ADMIN' /* 최종수정아이디 lstUpdId */
    WHERE SRC_UID = #{srcUidByUpsertPop}
  </update>

  <!-- 출처정보 상세조회 - 팝업용 -->
  <select id="selectSrcDetailBySrcUid2" parameterType="string" resultType="camelcasemap">
    SELECT SSI.SRC_UID /* 출처채번 */
         , SSI.SRC_UNO /* 출처고유번호 */
         , SSI.SRC_NM /* 출처명 */
         , SSI.DMSTC_YN /* 국내여부 */
         , CASE SSI.DMSTC_YN
             WHEN 'Y' THEN '국내'
             WHEN 'N' THEN '해외'
      END                                                   AS DMSTC_YN_NM /* 국내여부명 */
         , SSI.FST_INS_DT /* 최초등록일 */
         , SSI.FST_INS_ID /* 최초등록아이디 */
         , SSI.LST_UPD_DT /* 최종수정일 */
         , SSI.LST_UPD_ID /* 최종수정아이디 */
         , (SELECT COUNT(1)
            FROM ST_CONT_INFO SCI
            WHERE SCI.SRC_UID = SSI.SRC_UID)                             AS CONT_TOT_CNT /* 콘텐츠전체건수 */
         , (SELECT COUNT(1)
            FROM ST_CONT_INFO SCI
            WHERE SCI.SRC_UID = SSI.SRC_UID
              AND SCI.CONT_KIND_CD = '10')                               AS CONT_DOC_CNT /* 콘텐츠문서건수 */
         , (SELECT COUNT(1)
            FROM ST_CONT_INFO SCI
            WHERE SCI.SRC_UID = SSI.SRC_UID
              AND SCI.CONT_KIND_CD = '20')                               AS CONT_MOV_CNT /* 콘텐츠영상건수 */
    FROM ST_SRC_INFO SSI /* 출처정보 */
    WHERE SSI.SRC_UID = #{srcUid} /* 출처채번 */
  </select>

  <!-- 출처정보를 가지는 컨텐츠 리스트 조회 - 팝업용 -->
  <select id="selectContentBySrcUid2" parameterType="string" resultType="camelcasemap">
    SELECT SCI.CONT_UID /* 콘텐츠채번 */
         , SCI.CONT_UNO /* 콘텐츠고유번호 */
         , SCI.CONT_KIND_CD /* 콘텐츠종류코드 */
         , fnCommCdNm('CONT_KIND_CD', CONT_KIND_CD)         AS CONT_KIND_CD_NM /* 콘텐츠종류코드명 */
         , SCI.CONT_RMTHD_CD /* 콘텐츠등록방식코드 */
         , fnCommCdNm('CONT_RMTHD_CD', CONT_RMTHD_CD)       AS CONT_RMTHD_CD_NM /* 콘텐츠등록방식코드명 */
         , SCI.CONT_NM /* 콘텐츠명 */
         , SCI.PBLCN_DTE /* 발행일자 */
         , SCI.PBLCN_YY /* 발행YY */
         , SCI.PBLCN_MM /* 발행MM */
         , SCI.PBLCN_DD /* 발행DD */
         , SCI.DMSTC_YN /* 국내여부 */
         , CASE SCI.DMSTC_YN
             WHEN 'Y' THEN '국내'
             WHEN 'N' THEN '해외'
      END                                                   AS DMSTC_YN_NM /* 국내여부명 */
         , SCI.SPLY_LANG_CD /* 제공언어코드 */
         , fnCommCdNm('SPLY_LANG_CD', SPLY_LANG_CD)         AS SPLY_LANG_CD_NM /* 제공언어코드명 */
         , SCI.CONT_TP_LCLSF_CD /* 콘텐츠유형대분류코드 */
         , fnCommCdNm('CONT_TP_LCLSF_CD', CONT_TP_LCLSF_CD) AS CONT_TP_LCLSF_CD_NM /* 콘텐츠유형대분류코드명 */
         , SCI.CONT_TP_MCLSF_CD /* 콘텐츠유형중분류코드 */
         , fnCommCdNm('CONT_TP_MCLSF_CD', CONT_TP_MCLSF_CD) AS CONT_TP_MCLSF_CD_NM /* 콘텐츠유형중분류코드명 */
         , SCI.TASK_CLSF_CD /* 업무분류코드 */
         , fnCommCdNm('TASK_CLSF_CD', TASK_CLSF_CD)         AS TASK_CLSF_CD_NM /* 업무분류코드명 */
         , SCI.TPIC_MNU_CD /* 토픽메뉴코드(주제분류) */
         , fnCommCdNm('TPIC_MNU_CD', SCI.TPIC_MNU_CD)           AS TPIC_MNU_CD_NM /* 토픽메뉴코드명 */
         , SCI.USE_YN /* 사용여부 */
         , SCI.DP_YN /* 전시여부 */
         , SCI.DP_TP_CD /* 전시유형코드 */
         , fnCommCdNm('DP_TP_CD', DP_TP_CD)                 AS DP_TP_CD_NM /* 전시유형코드명 */
         , SCI.DP_STT_DT /* 전시시작일 */
         , SCI.DP_END_DT /* 전시종료일 */
         , SCI.PIRD_STNG_USE_YN /* 기간설정사용여부 */
         , SCI.DWNLD_PSBLTY_YN /* 다운로드가능여부 */
         , CASE SCI.DWNLD_PSBLTY_YN
             WHEN 'Y' THEN '가능'
             WHEN 'N' THEN '불가'
      END                                                   AS DWNLD_PSBLTY_YN_NM /* 국내여부명 */
         , SCI.SRCH_PSBLTY_YN /* 검색가능여부 */
         , CASE SCI.SRCH_PSBLTY_YN
             WHEN 'Y' THEN '가능'
             WHEN 'N' THEN '불가'
      END                                                   AS SRCH_PSBLTY_YN_NM /* 국내여부명 */
         , SCI.CONT_SUMRY /* 콘텐츠요약 */
         , SCI.CONT_ST_CD /* 콘텐츠상태코드 */
         , SCI.KWRD_ARRY /* 키워드배열 */
         , SCI.RLS_TGT_CD_ARRY /* 공개대상코드배열 */
         , SCI.SRC_UID /* 출처채번 */
         , SCI.ATAC_FILE_UID /* 첨부파일채번 */
         , SCI.FST_INS_DT /* 최초등록일 */
         , SCI.FST_INS_ID /* 최초등록아이디 */
         , SCI.LST_UPD_DT /* 최종수정일 */
         , SCI.LST_UPD_ID /* 최종수정아이디 */
    FROM ST_CONT_INFO SCI /* 콘텐츠정보 */
    WHERE SCI.SRC_UID = #{srcUid}
  </select>

  <!-- 출처명 수정 -->
  <update id="updateSrcInfoToSrcNmBySrcId2" parameterType="hashMap">
    UPDATE ST_SRC_INFO
    SET SRC_NM     = #{srcNmByDetailEditPop}
      , LST_UPD_DT = CURRENT_TIMESTAMP /* 최종수정일 */
      , LST_UPD_ID = 'ADMIN' /* 최종수정아이디 lstUpdId */
    WHERE SRC_UID = #{srcUidByDetailEditPop}
  </update>

  <!-- 콘텐츠검색 목록 조회 -->
  <select id="selectContentSearchPopList2" parameterType="camelcasemap" resultType="camelcasemap">
    SELECT
    SCI.CONT_UID /* 콘텐츠채번 */
    , SCI.CONT_UNO /* 콘텐츠고유번호 */
    , SCI.CONT_KIND_CD /* 콘텐츠종류코드 */
    , fnCommCdNm('CONT_KIND_CD', SCI.CONT_KIND_CD) AS CONT_KIND_CD_NM /* 콘텐츠종류코드명 */
    , SCI.CONT_RMTHD_CD /* 콘텐츠등록방식코드 */
    , fnCommCdNm('CONT_RMTHD_CD', SCI.CONT_RMTHD_CD) AS CONT_RMTHD_CD_NM /* 콘텐츠등록방식코드명 */
    , SCI.CONT_NM /* 콘텐츠명 */
    , SCI.PBLCN_DTE /* 발행일자 */
    , SCI.PBLCN_YY /* 발행YY */
    , SCI.PBLCN_MM /* 발행MM */
    , SCI.PBLCN_DD /* 발행DD */
    , SCI.DMSTC_YN /* 국내여부 */
    , CASE SCI.DMSTC_YN
    WHEN 'Y' THEN '국내'
    WHEN 'N' THEN '해외'
    END AS DMSTC_YN_NM /* 국내여부명 */
    , SCI.SPLY_LANG_CD /* 제공언어코드 */
    , fnCommCdNm('SPLY_LANG_CD', SCI.SPLY_LANG_CD) AS SPLY_LANG_CD_NM /* 제공언어코드명 */
    , SCI.CONT_TP_LCLSF_CD /* 콘텐츠유형대분류코드 */
    , fnCommCdNm('CONT_TP_LCLSF_CD', SCI.CONT_TP_LCLSF_CD) AS CONT_TP_LCLSF_CD_NM /* 콘텐츠유형대분류코드명 */
    , SCI.CONT_TP_MCLSF_CD /* 콘텐츠유형중분류코드 */
    , fnCommCdNm('CONT_TP_MCLSF_CD', SCI.CONT_TP_MCLSF_CD) AS CONT_TP_MCLSF_CD_NM /* 콘텐츠유형중분류코드명 */
    , SCI.TASK_CLSF_CD /* 업무분류코드 */
    , fnCommCdNm('TASK_CLSF_CD', SCI.TASK_CLSF_CD) AS TASK_CLSF_CD_NM /* 업무분류코드명 */
    , SCI.TPIC_MNU_CD /* 토픽메뉴코드 */
    , fnCommCdNm('TPIC_MNU_CD', SCI.TPIC_MNU_CD) AS TPIC_MNU_CD_NM /* 토픽메뉴명 */
    , SCI.USE_YN /* 사용여부 */
    , SCI.DP_YN /* 전시여부 */
    , SCI.DP_TP_CD /* 전시유형코드 */
    , fnCommCdNm('DP_TP_CD', SCI.DP_TP_CD) AS DP_TP_CD_NM /* 전시유형코드명 */
    , SCI.DP_STT_DT /* 전시시작일 */
    , SCI.DP_END_DT /* 전시종료일 */
    , SCI.PIRD_STNG_USE_YN /* 기간설정사용여부 */
    , SCI.DWNLD_PSBLTY_YN /* 다운로드가능여부 */
    , CASE SCI.DWNLD_PSBLTY_YN
    WHEN 'Y' THEN '가능'
    WHEN 'N' THEN '불가'
    END AS DWNLD_PSBLTY_YN_NM /* 국내여부명 */
    , SCI.SRCH_PSBLTY_YN /* 검색가능여부 */
    , CASE SCI.SRCH_PSBLTY_YN
    WHEN 'Y' THEN '가능'
    WHEN 'N' THEN '불가'
    END AS SRCH_PSBLTY_YN_NM /* 국내여부명 */
    , SCI.CONT_SUMRY /* 콘텐츠요약 */
    , SCI.CONT_ST_CD /* 콘텐츠상태코드 */
    , SCI.KWRD_ARRY /* 키워드배열 */
    , SCI.RLS_TGT_CD_ARRY /* 공개대상코드배열 */
    , SCI.SRC_UID /* 출처채번 */
    , SCI.ATAC_FILE_UID /* 첨부파일채번 */
    , SCI.FST_INS_DT /* 최초등록일 */
    , SCI.FST_INS_ID /* 최초등록아이디 */
    , SCI.LST_UPD_DT /* 최종수정일 */
    , SCI.LST_UPD_ID /* 최종수정아이디 */
    , (SELECT CONT_SPLY_TP_CD
           FROM ST_CONT_APND_INFO
           WHERE CONT_UID = SCI.CONT_UID
           AND CONT_KIND_CD = SCI.CONT_KIND_CD
           AND CONT_RMTHD_CD = SCI.CONT_RMTHD_CD
           AND CONT_KIND_CD != '50') AS CONT_SPLY_TP_CD /* 제공유형코드 */
    , (SELECT fnCommCdNm('CONT_SPLY_TP_CD', CONT_SPLY_TP_CD)
          FROM ST_CONT_APND_INFO
          WHERE CONT_UID = SCI.CONT_UID
          AND CONT_KIND_CD = SCI.CONT_KIND_CD
          AND CONT_RMTHD_CD = SCI.CONT_RMTHD_CD
          AND CONT_KIND_CD != '50') AS CONT_SPLY_TP_CD_NM /* 제공유형코드명 */
    FROM ST_CONT_INFO SCI /* 콘텐츠정보 */
    <where>
      <!-- 검색조건 : 콘텐츠명/번호 -->
      <choose>
        <!-- 콘텐츠명 -->
        <when test="schContentOpt.equals('01')">
          <if test="schContentWrd != null and !schContentWrd.equals('')">
            AND SCI.CONT_NM LIKE CONCAT(#{schContentWrd}, '%')
          </if>
        </when>
        <!-- 콘텐츠번호 -->
        <when test="schContentOpt.equals('02')">
          <if test="schContentWrd != null and !schContentWrd.equals('')">
            AND SCI.CONT_UNO LIKE CONCAT(#{schContentWrd}, '%')
          </if>
        </when>
        <!-- 조건없음 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 콘텐츠종류 -->
      <if test="schContKindOpt != null and schContKindOpt != '' and !schContKindOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_KIND_CD <![CDATA[=]]> #{schContKindOpt}
      </if>

      <!-- 검색조건 : 콘텐츠등록방식 -->
      <if test="schContRmthdOpt != null and schContRmthdOpt != '' and !schContRmthdOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_RMTHD_CD <![CDATA[=]]> #{schContRmthdOpt}
      </if>

      <!-- 검색조건 : 출처명/번호 -->
      <choose>
        <!-- 출처명 -->
        <when test="schSrcOpt.equals('01')">
          <if test="schSrcWrd != null and !schSrcWrd.equals('')">
            AND SCI.SRC_UID IN (
            SELECT SRC_UID
            FROM ST_SRC_INFO
            WHERE SRC_NM LIKE CONCAT(#{schSrcWrd}, '%')
            )
          </if>
        </when>
        <!-- 출처번호 -->
        <when test="schSrcOpt.equals('02')">
          <if test="schSrcWrd != null and !schSrcWrd.equals('')">
            AND SCI.SRC_UID IN (
            SELECT SRC_UID
            FROM ST_SRC_INFO
            WHERE SRC_UNO LIKE CONCAT(#{schSrcWrd}, '%')
            )
          </if>
        </when>
        <!-- 조건없음 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 국내여부 -->
      <if test="schDmstcChk != null and !schDmstcChk.equalsIgnoreCase('ALL')">
        AND SCI.DMSTC_YN <![CDATA[=]]> #{schDmstcChk}
      </if>

      <!-- 검색조건 : 유형대분류 -->
      <if test="schContTpLclsfOpt != null and schContTpLclsfOpt != '' and !schContTpLclsfOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_TP_LCLSF_CD <![CDATA[=]]> #{schContTpLclsfOpt}
      </if>

      <!-- 검색조건 : 유형중분류 -->
      <if test="schContTpMclsfOpt != null and schContTpMclsfOpt != '' and !schContTpMclsfOpt.equalsIgnoreCase('ALL')">
        AND SCI.CONT_TP_MCLSF_CD <![CDATA[=]]> #{schContTpMclsfOpt}
      </if>

      <!-- 검색조건 : 업무 분류 -->
      <if test="schTaskClsfOpt != null and schTaskClsfOpt != '' and !schTaskClsfOpt.equalsIgnoreCase('ALL')">
        AND SCI.TASK_CLSF_CD <![CDATA[=]]> #{schTaskClsfOpt}
      </if>

      <!-- 검색조건 : 주제 분류 - 보류!! -->

      <!-- 검색조건 : 컨텐츠번호 다중검색 -->
      <!--// todo 컨텐츠번호 다중검색 만들어야 함 -->

    </where>
  </select>

  <!-- 출처 검색 -->
  <select id="selectSrcSearchPopView2" parameterType="camelcasemap" resultType="camelcasemap">
    SELECT
			SSI.SRC_UID /* 출처채번 */
			, SSI.SRC_UNO /* 출처고유번호 */
			, SSI.SRC_NM /* 출처명 */
			, SSI.DMSTC_YN /* 국내여부 */
			, CASE SSI.DMSTC_YN
			WHEN 'Y' THEN '국내'
			WHEN 'N' THEN '해외'
			END AS DMSTC_YN_NM /* 국내여부명 */
			, SSI.FST_INS_DT /* 최초등록일 */
			, SSI.FST_INS_ID /* 최초등록아이디 */
			, SSI.LST_UPD_DT /* 최종수정일 */
			, SSI.LST_UPD_ID /* 최종수정아이디 */
    FROM ST_SRC_INFO SSI /* 출처정보 */
    <where>
      <!-- 검색조건 : 출처명/번호 -->
      <choose>
        <!-- 출처명 -->
        <when test="schSrcOptBySrcSearchPop.equals('01')">
          <if test="schSrcWrdBySrcSearchPop != null and !schSrcWrdBySrcSearchPop.equals('')">
            AND SSI.SRC_NM LIKE CONCAT(#{schSrcWrdBySrcSearchPop}, '%')
          </if>
        </when>
        <!-- 출처번호 -->
        <when test="schSrcOptBySrcSearchPop.equals('02')">
          <if test="schSrcWrdBySrcSearchPop != null and !schSrcWrdBySrcSearchPop.equals('')">
            AND SSI.SRC_UNO LIKE CONCAT(#{schSrcWrdBySrcSearchPop}, '%')
          </if>
        </when>
        <!-- 조건없음 안함 = pass -->
        <otherwise>
        </otherwise>
      </choose>

      <!-- 검색조건 : 국내/해외 -->
      <if test="schDmstcChkBySrcSearchPop != null and !schDmstcChkBySrcSearchPop.equalsIgnoreCase('ALL')">
        AND SSI.DMSTC_YN = #{schDmstcChkBySrcSearchPop} /* 국내여부 */
      </if>
    </where>
    ORDER BY SSI.FST_INS_DT DESC
  </select>

  <insert id="insertContInfo2" parameterType="camelcasemap">
    /* order="BEFORE" 삽입 전에 조회 */
    /* selectKey 구문의 위치는 INSERT 쿼리 위, 아래 상관 없이 위치할 수 있습니다. */
    <selectKey keyProperty="contUid" resultType="int" order="BEFORE">
      SELECT NEXTVAL('ST_CONT_INFO_SQ01')
    </selectKey>

    INSERT INTO ST_CONT_INFO /* 콘텐츠정보 */
      (
        CONT_UID					/* 콘텐츠채번 */
         , CONT_UNO					/* 콘텐츠고유번호 */
         , CONT_KIND_CD					/* 콘텐츠종류코드 */
         , CONT_RMTHD_CD					/* 콘텐츠등록방식코드 */
         , CONT_NM					/* 콘텐츠명 */
         , PBLCN_DTE					/* 발행일자 */
         , PBLCN_GB_CD      /* 발행구분코드 */
         , PBLCN_YY					/* 발행YY */
         , PBLCN_MM					/* 발행MM */
         , PBLCN_DD					/* 발행DD */
         , DMSTC_YN					/* 국내여부 */
         , SPLY_LANG_CD					/* 제공언어코드 */
         , CONT_TP_LCLSF_CD					/* 콘텐츠유형대분류코드 */
         , CONT_TP_MCLSF_CD					/* 콘텐츠유형중분류코드 */
         , TASK_CLSF_CD					/* 업무분류코드 */
         , USE_YN					/* 사용여부 */
         , DP_YN					/* 전시여부 */
         , DP_TP_CD					/* 전시유형코드 */
         , DP_STT_DT					/* 전시시작일 */
         , DP_END_DT					/* 전시종료일 */
         , PIRD_STNG_USE_YN					/* 기간설정사용여부 */
         , DWNLD_PSBLTY_YN					/* 다운로드가능여부 */
         , SRCH_PSBLTY_YN					/* 검색가능여부 */
         , CONT_SUMRY					/* 콘텐츠요약 */
         , CONT_ST_CD					/* 콘텐츠상태코드 */
         , KWRD_ARRY					/* 키워드배열 */
         , RLS_TGT_CD_ARRY					/* 공개대상코드배열 */
         , SRC_UID					/* 출처채번 */
         , ATAC_FILE_UID					/* 첨부파일채번 */
         , FST_INS_DT					/* 최초등록일 */
         , FST_INS_ID					/* 최초등록아이디 */
         , LST_UPD_DT					/* 최종수정일 */
         , LST_UPD_ID					/* 최종수정아이디 */
         , TPIC_MNU_CD          /* 토픽메뉴코드(주제영역) */
         , LINK_URL            /* 링크주소(RSS피드) */
        ) VALUES (
          #{contUid}    /* 콘텐츠채번 */
          , (
            CASE
                WHEN #{contKindCd} = '10'  /* 문서 */
                    THEN CASE
                        WHEN #{contRmthdCd} = '10'        /* 컨텐츠업로드 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CDIP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CDIA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                        WHEN #{contRmthdCd} = '20'    /* 아웃링크 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CDOP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CDOA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                        WHEN #{contRmthdCd} = '30'    /* 임베드 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CDOP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CDOA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                    END
                WHEN #{contKindCd} = '20'  /* 영상 */
                    THEN CASE
                        WHEN #{contRmthdCd} = '10'        /* 컨텐츠업로드 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMIP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMIA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                        WHEN #{contRmthdCd} = '20'    /* 아웃링크 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMOP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMOA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                        WHEN #{contRmthdCd} = '30'    /* 임베드 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMOP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMOA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                    END
                WHEN #{contKindCd} = '30'  /* 영상 */
                    THEN CASE
                        WHEN #{contRmthdCd} = '10'        /* 컨텐츠업로드 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMIP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMIA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                        WHEN #{contRmthdCd} = '20'    /* 아웃링크 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMOP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMOA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                        WHEN #{contRmthdCd} = '30'    /* 임베드 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMOP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMOA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                    END
                WHEN #{contKindCd} = '40'  /* 뉴스 */
                    THEN CASE
                        WHEN #{contRmthdCd} = '10'        /* 컨텐츠업로드 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMIP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMIA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                        WHEN #{contRmthdCd} = '20'    /* 아웃링크 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMOP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMOA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                        WHEN #{contRmthdCd} = '30'    /* 임베드 */
                          THEN CASE WHEN #{contTpLclsfCd} = '10'    /* 삼일 */
                              THEN CONCAT('CMOP', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              ELSE CONCAT('CMOA', LPAD(NEXTVAL('ST_CONT_INFO_SQ02'), 5, '0'))
                              END
                    END
                END
            )       /* 콘텐츠고유번호 */
          , #{contKindCd} /* 콘텐츠종류코드 */
          , #{contRmthdCd} /* 콘텐츠등록방식코드 */
          , #{contNm} /* 콘텐츠명 */
          , #{pblcnDte} /* 발행일자 */
          , #{pblcnGbCd} /* 발행구분코드 */
          , #{pblcnYy} /* 발행yy */
          , #{pblcnMm} /* 발행mm */
          , #{pblcnDd} /* 발행dd */
          , #{dmstcYn} /* 국내여부 */
          , #{splyLangCd} /* 제공언어코드 */
          , #{contTpLclsfCd} /* 콘텐츠유형대분류코드 */
          , #{contTpMclsfCd} /* 콘텐츠유형중분류코드 */
          , #{taskClsfCd} /* 업무분류코드 */
          , 'Y' /* 사용여부 useYn */
          , 'Y' /* 전시여부 dpYn */
          , #{dpTpCd} /* 전시유형코드 */
          , STR_TO_DATE(CONCAT(#{dpSttDte}, #{dpSttHh}, #{dpSttMi}), '%Y-%m-%d%H%i%s') /* 전시시작일 */
          , STR_TO_DATE(CONCAT(#{dpEndDte}, #{dpEndHh}, #{dpEndMi}), '%Y-%m-%d%H%i%s')  /* 전시종료일 */
          , #{pirdStngUseYn} /* 기간설정사용여부 pirdStngUseYn */
          , #{dwnldPsbltyYn} /* 다운로드가능여부 */
          , #{srchPsbltyYn} /* 검색가능여부 */
          , #{contSumry} /* 콘텐츠요약 */
          , '10' /* 콘텐츠상태코드 contStCd */
          , '' /* 키워드배열 */
          , '' /* 공개대상코드배열 rlsTgtCdArry */
          , #{srcUid} /* 출처채번 */
          , #{atacFileUid} /* 첨부파일채번 */
          , CURRENT_TIMESTAMP /* 최초등록일 */
          , 'ADMIN' /* 최초등록아이디 fstInsId */
          , CURRENT_TIMESTAMP /* 최종수정일 */
          , 'ADMIN' /* 최종수정아이디 lstUpdId */
          , #{tpicMnuCd}
          , ''
      )
  </insert>

  <update id="updateContInfo2" parameterType="camelcasemap">
    UPDATE ST_CONT_INFO  /* 콘텐츠정보 */
    SET CONT_NM = #{contNm}					/* 콘텐츠명 */
    , PBLCN_DTE = #{pblcnDte}					/* 발행일자 */
    , PBLCN_GB_CD = #{pblcnGbCd}     /* 발행구분코드 */
    , PBLCN_YY = #{pblcnYy} 					/* 발행YY */
    , PBLCN_MM = #{pblcnMm}					/* 발행MM */
    , PBLCN_DD = #{pblcnDd}					/* 발행DD */
    , DMSTC_YN = #{dmstcYn}					/* 국내여부 */
    , SPLY_LANG_CD = #{splyLangCd}					/* 제공언어코드 */
    , DP_TP_CD = #{dpTpCd} 					/* 전시유형코드 */
    , DP_STT_DT	= STR_TO_DATE(CONCAT(#{dpSttDte}, #{dpSttHh}, #{dpSttMi}), '%Y-%m-%d%H%i%s')				/* 전시시작일 */
    , DP_END_DT = STR_TO_DATE(CONCAT(#{dpEndDte}, #{dpEndHh}, #{dpEndMi}), '%Y-%m-%d%H%i%s')					/* 전시종료일 */
    , PIRD_STNG_USE_YN = #{pirdStngUseYn}					/* 기간설정사용여부 */
    , DWNLD_PSBLTY_YN	= #{dwnldPsbltyYn}				/* 다운로드가능여부 */
    , SRCH_PSBLTY_YN = #{srchPsbltyYn}					/* 검색가능여부 */
    , CONT_SUMRY = #{contSumry}					/* 콘텐츠요약 */
    , CONT_ST_CD = #{contStCd}					/* 콘텐츠상태코드 */
    , SRC_UID	= #{srcUid}				/* 출처채번 */
    , ATAC_FILE_UID	= #{atacFileUid}				/* 첨부파일채번 */
    , LST_UPD_DT = CURRENT_TIMESTAMP					/* 최종수정일 */
    , LST_UPD_ID = 'ADMIN'					/* 최종수정아이디 */
    WHERE CONT_UID = #{contUid}
  </update>

  <select id="selectShowByContentUpsertPop2" parameterType="string" resultType="camelcasemap">
    SELECT SCI.CONT_UID /* 콘텐츠채번 */
         , SCI.CONT_UNO /* 콘텐츠고유번호 */
         , SCI.CONT_KIND_CD /* 콘텐츠종류코드 */
         , fnCommCdNm('CONT_KIND_CD', SCI.CONT_KIND_CD)         AS CONT_KIND_CD_NM /* 콘텐츠종류코드명 */
         , SCI.CONT_RMTHD_CD /* 콘텐츠등록방식코드 */
         , fnCommCdNm('CONT_RMTHD_CD', SCI.CONT_RMTHD_CD)       AS CONT_RMTHD_CD_NM /* 콘텐츠등록방식코드명 */
         , SCI.CONT_NM /* 콘텐츠명 */
         , SCI.PBLCN_DTE /* 발행일자 */
         , SCI.PBLCN_GB_CD /* 발행구분코드 */
         , SCI.PBLCN_YY /* 발행YY */
         , SCI.PBLCN_MM /* 발행MM */
         , SCI.PBLCN_DD /* 발행DD */
         , SCI.DMSTC_YN /* 국내여부 */
         , CASE SCI.DMSTC_YN
             WHEN 'Y' THEN '국내'
             WHEN 'N' THEN '해외'
      END                                                       AS DMSTC_YN_NM /* 국내여부명 */
         , SCI.SPLY_LANG_CD /* 제공언어코드 */
         , fnCommCdNm('SPLY_LANG_CD', SCI.SPLY_LANG_CD)         AS SPLY_LANG_CD_NM /* 제공언어코드명 */
         , SCI.CONT_TP_LCLSF_CD /* 콘텐츠유형대분류코드 */
         , fnCommCdNm('CONT_TP_LCLSF_CD', SCI.CONT_TP_LCLSF_CD) AS CONT_TP_LCLSF_CD_NM /* 콘텐츠유형대분류코드명 */
         , SCI.CONT_TP_MCLSF_CD /* 콘텐츠유형중분류코드 */
         , fnCommCdNm('CONT_TP_MCLSF_CD', SCI.CONT_TP_MCLSF_CD) AS CONT_TP_MCLSF_CD_NM /* 콘텐츠유형중분류코드명 */
         , SCI.TASK_CLSF_CD /* 업무분류코드 */
         , fnCommCdNm('TASK_CLSF_CD', SCI.TASK_CLSF_CD)         AS TASK_CLSF_CD_NM /* 업무분류코드명 */
         , SCI.USE_YN /* 사용여부 */
         , SCI.DP_YN /* 전시여부 */
         , SCI.DP_TP_CD /* 전시유형코드 */
         , fnCommCdNm('DP_TP_CD', SCI.DP_TP_CD)                 AS DP_TP_CD_NM /* 전시유형코드명 */
         , DATE_FORMAT(SCI.DP_STT_DT, '%Y-%m-%d')               AS DP_STT_DTE /* 전시시작일 */
         , DATE_FORMAT(SCI.DP_STT_DT, '%H')                     AS DP_STT_HH /* 전시시작일 */
         , DATE_FORMAT(SCI.DP_STT_DT, '%i')                     AS DP_STT_MI /* 전시시작일 */
         , DATE_FORMAT(SCI.DP_END_DT, '%Y-%m-%d')               AS DP_END_DTE /* 전시종료일 */
         , DATE_FORMAT(SCI.DP_END_DT, '%H')                     AS DP_END_HH /* 전시종료일 */
         , DATE_FORMAT(SCI.DP_END_DT, '%i')                     AS DP_END_MI /* 전시종료일 */
         , SCI.PIRD_STNG_USE_YN /* 기간설정사용여부 */
         , SCI.DWNLD_PSBLTY_YN /* 다운로드가능여부 */
         , CASE SCI.DWNLD_PSBLTY_YN
             WHEN 'Y' THEN '가능'
             WHEN 'N' THEN '불가'
      END                                                       AS DWNLD_PSBLTY_YN_NM /* 국내여부명 */
         , SCI.SRCH_PSBLTY_YN /* 검색가능여부 */
         , CASE SCI.SRCH_PSBLTY_YN
             WHEN 'Y' THEN '가능'
             WHEN 'N' THEN '불가'
      END                                                       AS SRCH_PSBLTY_YN_NM /* 국내여부명 */
         , SCI.CONT_SUMRY /* 콘텐츠요약 */
         , SCI.CONT_ST_CD /* 콘텐츠상태코드 */
         , SCI.KWRD_ARRY /* 키워드배열 */
         , SCI.RLS_TGT_CD_ARRY /* 공개대상코드배열 */
         , SCI.SRC_UID /* 출처채번 */
         , SCI.ATAC_FILE_UID /* 첨부파일채번 */
         , SCI.FST_INS_DT /* 최초등록일 */
         , SCI.FST_INS_ID /* 최초등록아이디 */
         , SCI.LST_UPD_DT /* 최종수정일 */
         , SCI.LST_UPD_ID /* 최종수정아이디 */
         , SCAI_IMAGE.SEQ_NO /* 순번 */
         , SCAI_IMAGE.LINK_URL /* 링크주소 */
         , SCI.TPIC_MNU_CD /* 토픽메뉴코드(주제분류) */
         , fnCommCdNm('TPIC_MNU_CD', SCI.TPIC_MNU_CD)           AS TPIC_MNU_CD_NM /* 토픽메뉴코드명 */
         , SCAI_IMAGE.NWIN_YN
         , SCAI_IMAGE.CONT_SPLY_TP_CD
         , fnCommCdNm('CONT_SPLY_TP_CD', SCAI_IMAGE.CONT_SPLY_TP_CD)  AS CONT_SPLY_TP_CD_NM /* 콘텐츠제공유형코드명 */
         , SCAI_IMAGE.VOD_QUNTY_HH
         , SCAI_IMAGE.VOD_QUNTY_MI
         , SCAI_IMAGE.VOD_QUNTY_SEC
         , SCAI_IMAGE.PAGE_CNT
         , SCAI_IMAGE.LESN_NM
         , SCAI_IMAGE.VOD_COMNT
         , SCAI_IMAGE.ATAC_FILE_UID
         , SCAI_IMAGE.ATAC_DTL_UID
         , SCAI_IMAGE.CNVN_FILE_FPATH
         , SSI.SRC_NM
         , (SELECT GROUP_CONCAT(RLS_TGT_CD)
            FROM ST_CONT_RLS_TGT_INFO
            WHERE CONT_UID = SCI.CONT_UID
            GROUP BY CONT_UID)                                  AS RLS_TGT_CDS
         , (SELECT GROUP_CONCAT(fnCommCdNm('RLS_TGT_CD', RLS_TGT_CD))
            FROM ST_CONT_RLS_TGT_INFO
            WHERE CONT_UID = SCI.CONT_UID
            GROUP BY CONT_UID)                                  AS RLS_TGT_CD_NMS
         , (SELECT GROUP_CONCAT(TAG_KWRD)
            FROM ST_KWRD_INFO
            WHERE CONT_UID = SCI.CONT_UID
            GROUP BY CONT_UID)                                  AS TAG_KWRDS
    FROM ST_CONT_INFO SCI /* 콘텐츠정보 */
           LEFT JOIN (SELECT TA_SCAI.CONT_UID
                      , TA_SCAI.CONT_KIND_CD
                      , TA_SCAI.SEQ_NO
                      , TA_SCAI.CONT_RMTHD_CD
                      , TA_SCAI.LINK_URL
                      , TA_SCAI.NWIN_YN
                      , TA_SCAI.CONT_SPLY_TP_CD
                      , TA_SCAI.VOD_QUNTY_HH
                      , TA_SCAI.VOD_QUNTY_MI
                      , TA_SCAI.VOD_QUNTY_SEC
                      , TA_SCAI.PAGE_CNT
                      , TA_SCAI.LESN_NM
                      , TA_SCAI.VOD_COMNT
                      , TA_SCAI.ATAC_FILE_UID
                      , TA_SCAI.ATAC_DTL_UID
                      , TB_CADI.ORGNL_FILE_FPATH
                      , TB_CADI.ORGNL_FILE_NM
                      , TB_CADI.ORGNL_EXTN
                      , TB_CADI.ORGNL_FILE_SZ
                      , TB_CADI.CNVN_FILE_FPATH
                      , TB_CADI.CNVN_FILE_NM
                      , TB_CADI.CNVN_EXTN
                      , TB_CADI.CNVN_FILE_SZ
                      FROM ST_CONT_APND_INFO TA_SCAI
                      INNER JOIN CM_ATAC_DTL_INFO TB_CADI
                        ON TA_SCAI.ATAC_FILE_UID = TB_CADI.ATAC_FILE_UID
                        AND TA_SCAI.ATAC_DTL_UID = TB_CADI.ATAC_DTL_UID
                      WHERE TA_SCAI.CONT_UID = #{contUid}
                      AND TA_SCAI.CONT_KIND_CD = '50') SCAI_IMAGE
                     ON SCAI_IMAGE.CONT_UID = SCI.CONT_UID
           LEFT JOIN ST_SRC_INFO SSI
                     ON SSI.SRC_UID = SCI.SRC_UID
    WHERE SCI.CONT_UID = #{contUid}
  </select>

  <select id="selectContApndAtacByContUid2" parameterType="string" resultType="camelcasemap">
    SELECT TA_SCAI.CONT_UID
         , TA_SCAI.CONT_KIND_CD
         , TA_SCAI.SEQ_NO
         , TA_SCAI.CONT_RMTHD_CD
         , TA_SCAI.LINK_URL
         , TA_SCAI.NWIN_YN
         , TA_SCAI.CONT_SPLY_TP_CD
         , TA_SCAI.VOD_QUNTY_HH
         , TA_SCAI.VOD_QUNTY_MI
         , TA_SCAI.VOD_QUNTY_SEC
         , TA_SCAI.PAGE_CNT
         , TA_SCAI.LESN_NM
         , TA_SCAI.VOD_COMNT
         , TA_SCAI.ATAC_FILE_UID
         , TA_SCAI.ATAC_DTL_UID
         , TB_CADI.ORGNL_FILE_FPATH
         , TB_CADI.ORGNL_FILE_NM
         , TB_CADI.ORGNL_EXTN
         , TB_CADI.ORGNL_FILE_SZ
         , TB_CADI.CNVN_FILE_FPATH
         , TB_CADI.CNVN_FILE_NM
         , TB_CADI.CNVN_EXTN
         , TB_CADI.CNVN_FILE_SZ
    FROM ST_CONT_APND_INFO TA_SCAI
           LEFT JOIN CM_ATAC_DTL_INFO TB_CADI
                      ON TA_SCAI.ATAC_FILE_UID = TB_CADI.ATAC_FILE_UID
                        AND TA_SCAI.ATAC_DTL_UID = TB_CADI.ATAC_DTL_UID
           INNER JOIN ST_CONT_INFO SCI
                      ON SCI.CONT_UID = #{contUid}
                        AND SCI.CONT_KIND_CD = TA_SCAI.CONT_KIND_CD
    WHERE TA_SCAI.CONT_UID = #{contUid}
  </select>

  <insert id="insertContRlsTgtInfo2" parameterType="camelcasemap">
    /* 공개대상정보 */
    INSERT INTO ST_CONT_RLS_TGT_INFO (
    CONT_UID /* 콘텐츠채번 */
    , RLS_TGT_CD /* 공개대상코드 */
    , FST_INS_DT /* 최초등록일 */
    , FST_INS_ID /* 최초등록아이디 */
    ) VALUES
    <foreach item="item" index="index" collection="rlsTgtCd" separator=",">
      (
      #{contUid}
      , #{item}
      , CURRENT_TIMESTAMP
      , 'ADMIN'
      )
    </foreach>
  </insert>

  <insert id="insertKwordInfo2" parameterType="camelcasemap">
    /* 키워드정보 */
    INSERT INTO ST_KWRD_INFO (
    CONT_UID /* 콘텐츠채번 */
    , TAG_KWRD /* 태그키워드 */
    , DP_SEQ /* 전시순서 */
    , FST_INS_DT /* 최초등록일 */
    , FST_INS_ID /* 최초등록아이디 */
    ) VALUES
    <foreach item="item" index="index" collection="tagKwrd" separator=",">
      (
      #{contUid}
      , #{item}
      , 1
      , CURRENT_TIMESTAMP
      , 'ADMIN'
      )
    </foreach>
  </insert>

  <delete id="deleteContRlsTgtInfo2" parameterType="string">
    DELETE FROM ST_CONT_RLS_TGT_INFO
    WHERE CONT_UID= #{contUid}
  </delete>

  <delete id="deleteKwordInfo2" parameterType="string">
    DELETE FROM ST_KWRD_INFO
    WHERE CONT_UID= #{contUid}
  </delete>

  <insert id="upsertContApndInfo2" parameterType="java.util.List">
    INSERT INTO ST_CONT_APND_INFO (
    CONT_UID                    /* 콘텐츠채번 */
    ,CONT_KIND_CD                    /* 콘텐츠종류코드 */
    ,SEQ_NO                    /* 순번 */
    ,CONT_RMTHD_CD                    /* 콘텐츠등록방식코드 */
    ,LINK_URL                    /* 링크주소 */
    ,NWIN_YN                    /* 새창여부 */
    ,CONT_SPLY_TP_CD                    /* 콘텐츠제공유형코드 */
    ,VOD_QUNTY_HH                    /* 영상분량시 */
    ,VOD_QUNTY_MI                    /* 영상분량분 */
    ,VOD_QUNTY_SEC                    /* 영상분량초 */
    ,PAGE_CNT                    /* 페이지수 */
    ,LESN_NM                    /* 레슨명 */
    ,VOD_COMNT                    /* 영상설명 */
    ,ATAC_FILE_UID                    /* 첨부파일채번 */
    ,ATAC_DTL_UID                    /* 첨부상세채번 */
    ,FST_INS_DT                    /* 최초등록일 */
    ,FST_INS_ID                    /* 최초등록아이디 */
    ,LST_UPD_DT                    /* 최종수정일 */
    ,LST_UPD_ID                    /* 최종수정아이디 */
    ) VALUES
    <foreach item="item" index="index" collection="list" separator=",">
          (
      #{item.contUid}                    /* 콘텐츠채번 */
      ,#{item.contKindCd}                    /* 콘텐츠종류코드 */
      ,#{item.seqNo}                    /* 순번 */
      ,#{item.contRmthdCd}                    /* 콘텐츠등록방식코드 */
      ,#{item.linkUrl}                    /* 링크주소 */
      ,#{item.nwinYn}                    /* 새창여부 */
      ,#{item.contSplyTpCd}                    /* 콘텐츠제공유형코드 */
      ,#{item.vodQuntyHh}                    /* 영상분량시 */
      ,#{item.vodQuntyMi}                    /* 영상분량분 */
      ,#{item.vodQuntySec}                    /* 영상분량초 */
      ,#{item.pageCnt}                    /* 페이지수 */
      ,#{item.lesnNm}                    /* 레슨명 */
      ,#{item.vodComnt}                    /* 영상설명 */
      ,#{item.atacFileUid}                    /* 첨부파일채번 */
      ,#{item.atacDtlUid}                    /* 첨부상세채번 */
      , CURRENT_TIMESTAMP
      , 'ADMIN'
      , CURRENT_TIMESTAMP
      , 'ADMIN'
      )
    </foreach>
    ON DUPLICATE KEY
    UPDATE
    CONT_RMTHD_CD  = values(CONT_RMTHD_CD)                   /* 콘텐츠등록방식코드 */
    ,LINK_URL  = values(LINK_URL)                    /* 링크주소 */
    ,NWIN_YN  = values(NWIN_YN)                    /* 새창여부 */
    ,CONT_SPLY_TP_CD  = values(CONT_SPLY_TP_CD)                    /* 콘텐츠제공유형코드 */
    ,VOD_QUNTY_HH  = values(VOD_QUNTY_HH)                    /* 영상분량시 */
    ,VOD_QUNTY_MI  = values(VOD_QUNTY_MI)                    /* 영상분량분 */
    ,VOD_QUNTY_SEC  = values(VOD_QUNTY_SEC)                    /* 영상분량초 */
    ,PAGE_CNT  = values(PAGE_CNT)                    /* 페이지수 */
    ,LESN_NM    = values(LESN_NM)                  /* 레슨명 */
    ,VOD_COMNT     = values(VOD_COMNT)                 /* 영상설명 */
    ,ATAC_FILE_UID   = values(ATAC_FILE_UID)                   /* 첨부파일채번 */
    ,ATAC_DTL_UID     = values(ATAC_DTL_UID)                 /* 첨부상세채번 */
    ,LST_UPD_DT   =  CURRENT_TIMESTAMP                  /* 최종수정일 */
    ,LST_UPD_ID    = 'ADMIN'                 /* 최종수정아이디 */
  </insert>

  <select id="selectContentTopicByTpicUid2" parameterType="camelcasemap" resultType="camelcasemap">
    SELECT SCI.CONT_UID /* 콘텐츠채번 */
         , SCI.CONT_UNO /* 콘텐츠고유번호 */
         , SCI.CONT_KIND_CD /* 콘텐츠종류코드 */
         , fnCommCdNm('CONT_KIND_CD', SCI.CONT_KIND_CD)         AS CONT_KIND_CD_NM /* 콘텐츠종류코드명 */
         , SCI.CONT_RMTHD_CD /* 콘텐츠등록방식코드 */
         , fnCommCdNm('CONT_RMTHD_CD', SCI.CONT_RMTHD_CD)       AS CONT_RMTHD_CD_NM /* 콘텐츠등록방식코드명 */
         , SCI.CONT_NM /* 콘텐츠명 */
         , SCI.PBLCN_DTE /* 발행일자 */
         , SCI.PBLCN_YY /* 발행YY */
         , SCI.PBLCN_MM /* 발행MM */
         , SCI.PBLCN_DD /* 발행DD */
         , SCI.DMSTC_YN /* 국내여부 */
         , CASE SCI.DMSTC_YN
             WHEN 'Y' THEN '국내'
             WHEN 'N' THEN '해외'
      END                                                       AS DMSTC_YN_NM /* 국내여부명 */
         , SCI.SPLY_LANG_CD /* 제공언어코드 */
         , fnCommCdNm('SPLY_LANG_CD', SCI.SPLY_LANG_CD)         AS SPLY_LANG_CD_NM /* 제공언어코드명 */
         , SCI.CONT_TP_LCLSF_CD /* 콘텐츠유형대분류코드 */
         , fnCommCdNm('CONT_TP_LCLSF_CD', SCI.CONT_TP_LCLSF_CD) AS CONT_TP_LCLSF_CD_NM /* 콘텐츠유형대분류코드명 */
         , SCI.CONT_TP_MCLSF_CD /* 콘텐츠유형중분류코드 */
         , fnCommCdNm('CONT_TP_MCLSF_CD', SCI.CONT_TP_MCLSF_CD) AS CONT_TP_MCLSF_CD_NM /* 콘텐츠유형중분류코드명 */
         , SCI.TASK_CLSF_CD /* 업무분류코드 */
         , fnCommCdNm('TASK_CLSF_CD', SCI.TASK_CLSF_CD)         AS TASK_CLSF_CD_NM /* 업무분류코드명 */
         , SCI.TPIC_MNU_CD /* 토픽메뉴코드 */
         , fnCommCdNm('TPIC_MNU_CD', SCI.TPIC_MNU_CD)           AS TPIC_MNU_CD_NM /* 토픽메뉴명 */
         , SCI.USE_YN /* 사용여부 */
         , SCI.DP_YN /* 전시여부 */
         , SCI.DP_TP_CD /* 전시유형코드 */
         , fnCommCdNm('DP_TP_CD', SCI.DP_TP_CD)                 AS DP_TP_CD_NM /* 전시유형코드명 */
         , SCI.DP_STT_DT /* 전시시작일 */
         , SCI.DP_END_DT /* 전시종료일 */
         , SCI.PIRD_STNG_USE_YN /* 기간설정사용여부 */
         , SCI.DWNLD_PSBLTY_YN /* 다운로드가능여부 */
         , CASE SCI.DWNLD_PSBLTY_YN
             WHEN 'Y' THEN '가능'
             WHEN 'N' THEN '불가'
      END                                                       AS DWNLD_PSBLTY_YN_NM /* 국내여부명 */
         , SCI.SRCH_PSBLTY_YN /* 검색가능여부 */
         , CASE SCI.SRCH_PSBLTY_YN
             WHEN 'Y' THEN '가능'
             WHEN 'N' THEN '불가'
      END                                                       AS SRCH_PSBLTY_YN_NM /* 국내여부명 */
         , SCI.CONT_SUMRY /* 콘텐츠요약 */
         , SCI.CONT_ST_CD /* 콘텐츠상태코드 */
         , SCI.KWRD_ARRY /* 키워드배열 */
         , SCI.RLS_TGT_CD_ARRY /* 공개대상코드배열 */
         , SCI.SRC_UID /* 출처채번 */
         , SCI.ATAC_FILE_UID /* 첨부파일채번 */
         , SCI.FST_INS_DT /* 최초등록일 */
         , SCI.FST_INS_ID /* 최초등록아이디 */
         , SCI.LST_UPD_DT /* 최종수정일 */
         , SCI.LST_UPD_ID /* 최종수정아이디 */
         , SSI.SRC_NM /* 출처명 */
    FROM ST_CONT_INFO SCI /* 콘텐츠정보 */
           LEFT JOIN ST_SRC_INFO SSI
                     ON SSI.SRC_UID = SCI.SRC_UID
    WHERE SCI.CONT_UID IN (SELECT CONT_UID
                           FROM DP_CONT_TPIC_INFO
                           WHERE TPIC_UID = #{tpicUid})
  </select>
</mapper>