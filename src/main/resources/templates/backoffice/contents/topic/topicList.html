<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{backoffice/layout/defaultLayout}">

<th:block layout:fragment="css">
    <style>
        .ck-editor__editable {
            height: 400px;
        }

        .ck-editor__editable p {
            margin: 0
        }

        .ck-content {
            font-size: 13px;
        }

        .contentsArea p {
            margin: 0
        }
    </style>
</th:block>

<th:block layout:fragment="script">
    <script src="/sems/assets/js/ckeditor/ckeditor.js"></script>
    <script src="/sems/assets/js/ckeditor/translations/ko.js"></script>
    <script src="/sems/assets/js/ckeditor/upload/uploadAdpater.js"></script>
    <script type="text/javascript">
        $(function () {
            // 화면 초기화
            fnInitView();

            // 기본 데이터 조회
            fnInitData();

            // 이벤트 설정
            fnInitEvent();
        });

        // 화면 초기화
        function fnInitView() {
            // _comLib.setDatePicker("schStrtDate","schEndDate", "yy-mm-dd");
            // _comLib.setDatePicker("schEndDate", null, "yy-mm-dd");
        }

        // 조회기간 설정
        function setSchDate() {
            //기간설정 안함,  직접입력
            // if($('input:radio[name=period]:checked').val()==""){
            // 	$("#schStrtDate").val("");
            // 	$("#schEndDate").val("");
            // 	return;
            // }
            //
            // var stDay = _comLib.preDay($('input:radio[name=period]:checked').val());
            // $("#schStrtDate").val(stDay);
            // $("#schEndDate").val(_comLib.toDay());
        }

        // 이벤트 설정
        function fnInitEvent() {
            // $("#btnSearch").bind("click", fnSelectTopicList);	//조회
            // $("#btnReset").bind("click", fnResetSearch);		//초기화
            // $('input:radio[name=period]').bind("click", setSchDate);//조회기간변경

            //페이지 사이즈 변경
            $("#topicPageSize").bind("change", function () {
                $('#topicPageNum').find('option:first').attr('selected', 'selected');//선택된 페이지 초기화
                fnSelectTopicList();	//페이지 사이즈변경
            });

            //페이지 번호 변경
            $("#topicPageNum").bind("change", fnSelectTopicList);

            //목록 전체 선택 및 해제
            $("#chkAll").on("click", function () {
                $("input[name='chkTopic']:checkbox").prop("checked", this.checked);
            });

            $("#btnTopicRegist").on("click", function () {
                fnTopicRegistViewPop('');
            });
        }

        // 기본 데이터 조회
        function fnInitData() {
            fnSelectTopicList();
        }

        //목록조회
        function fnSelectTopicList() {
            var formData, param = {};
            formData = _formLib.getFormData("searchListFrm");
            param = {
                "url": "/sems/contents/selectTpicBySearchCondition"
                , "type": "post"
                , "data": formData
                , "async": false
                , "callback": function (fragment) {
                    $("#topicListDiv").replaceWith(fragment);
                    $("#topicTotalCountView").text(
                        "총 " + _formLib.addComma($("#topicTotalCount").val()) + "건");

                    //페이징처리
                    var currPage = $('#topicPageNum').val();//현재 선택된 페이지
                    $('#topicPageNum').empty();//페이지 option 삭제
                    for (var count = 1; count <= $("#topicTotalPage").val(); count++) {
                        var selTxt = "";
                        if (count == currPage) {
                            selTxt = "selected='selected'";//현재 페이지 선택
                        }

                        var option = $("<option value='" + count + "' " + selTxt + ">" + count + "/" + $(
                            "#topicTotalPage").val() + "</option>");
                        $('#topicPageNum').append(option);
                    }
                }
            };
            _comLib.callAjax(param);
        }

        // 엑셀 다운로드
        function fnExcelDown() {
            // if (!confirm("다운로드 하시겠습니까?")) return;
            //
            // var data = "";
            // var formObj = $('<form></form>');
            // var formData = _formLib.getFormData("searchListFrm");
            // formObj.attr('method', 'post');
            // formObj.attr("action", "/sems/contents/selectTopicListExcelDown");
            // formObj.append($('<input/>', {type: 'hidden', name: 'schJoinType', value: formData.schJoinType}));//검색조건 : 가입일/탈퇴일 구분
            // formObj.append($('<input/>', {type: 'hidden', name: 'schStrtDate', value: formData.schStrtDate}));//검색조건 : 가입일/탈퇴일
            // formObj.append($('<input/>', {type: 'hidden', name: 'schCoprUid', value: formData.schCoprUid}));//검색조건 : 소속채번
            // formObj.append($('<input/>', {type: 'hidden', name: 'schMbrStCd', value: formData.schMbrStCd}));//검색조건 : 회원상태코드
            // formObj.append($('<input/>', {type: 'hidden', name: 'schMrkTAgreYn', value: formData.schMrkTAgreYn}));//검색조건 : 마케팅동의여부
            // formObj.append($('<input/>', {type: 'hidden', name: 'schNsltAgreYn', value: formData.schNsltAgreYn}));//검색조건 : 뉴스레터동의여부
            // formObj.append($('<input/>', {type: 'hidden', name: 'schIntrCd', value: formData.schIntrCd}));//검색조건 : ESG 관심영역
            // formObj.append($('<input/>', {type: 'hidden', name: 'schType', value: formData.schType}));//검색조건 : 아이디, 회원명, 회원번호
            // formObj.append($('<input/>', {type: 'hidden', name: 'schText', value: formData.schText}));//검색조건 : 검색어
            // formObj.appendTo('body');
            // formObj.submit();
        }

        //조회조건 초기화
        function fnResetSearch() {
            fnInitView();
            fnInitData();
        }

        // 로딩중 이미지 노출
        function startLoading() {

        }

        // 로딩중 이미지 비노출
        function endLoading() {

        }
    </script>
</th:block>

<div layout:fragment="content">
    <th:block layout:fragment="script_sub"></th:block>
    <form id="searchListFrm">
        <!-- container -->
        <section id="cont-section" class="content">
            <div class="location">
                <h3>토픽 조회</h3>
                <ul class="breadcrumb">
                    <li>컨텐츠 관리</li>
                    <li>토픽 조회</li>
                </ul>
            </div>
            <!-- //location -->
            <section>
                <h4 class="table-tit">토픽 조회</h4>
                <div class="search-wrap">
                    <fieldset>
                        <legend>토픽 조회</legend>
                        <div class="table-wrap">
                            <table class="inner-input">
                                <caption>토픽 조회</caption>
                                <colgroup>
                                    <col style="width: 20%;">
                                    <col style="width: 80%;">
                                </colgroup>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                        <!-- //table-wrap -->
                        <div class="btn-wrap">
                            <button type="button" id="btnSearch" class="btn-primary">조회</button>
                            <button type="button" id="btnReset" class="btn-sub">초기화</button>
                        </div>
                        <!-- //btn-wrap -->
                    </fieldset>
                </div>
                <!-- //search-wrap -->
            </section>
            <div class="result-wrap">
                <div class="total">
                    <span class="lable">토픽 리스트</span> - <strong id="topicTotalCountView">총 0건</strong>
                    <button type="button" id="btnTopicRegist" class="btn-del"><span>등록</span></button>
                </div>
                <!-- total -->
                <div class="sorting-wrap">
                    <select id="topicPageSize" name="topicPageSize" class="select" title="데이터 건수">
                        <option value="20">20개</option>
                        <option value="50">50개</option>
                        <option value="100" selected="selected">100개</option>
                        <option value="500">500개</option>
                        <option value="1000">1000개</option>
                    </select>
                    <select id="topicPageNum" name="topicPageNum" class="select" title="페이지 이동선택"> </select>
                </div>
                <!-- //sorting-wrap -->
                <div id="topicListDiv" class="table-wrap ">
                    <!-- 페이징 정보 -->
                    <th:block th:unless="${#lists.isEmpty(list)}">
                        <input type="hidden" id="topicTotalCount" th:value="${PageInfo.totalCount}"/>
                        <input type="hidden" id="topicPageNumber" th:value="${PageInfo.pageNumber}"/>
                        <input type="hidden" id="topicTotalPage" th:value="${PageInfo.totalPage}"/>
                    </th:block>
                    <table>
                        <caption>토픽 리스트</caption>
                        <colgroup>
                            <col style="width: 5%;">
                            <col style="width: 5%;">
                            <col style="width: 10%;">
                            <col style="width: 10%;">
                            <col style="width: 25%;">
                            <col style="width: 10%;">
                            <col style="width: 25%;">
                            <col style="width: 10%;">
                        </colgroup>
                        <thead>
                        <tr>
                            <th><input type="checkbox" id="chkAll" name="chkAll" value="전체선택" title="선택"></th>
                            <th>번호</th>
                            <th>구분</th>
                            <th>메뉴</th>
                            <th>토픽명</th>
                            <th>전시대상</th>
                            <th>전시기간</th>
                            <th>사용여부</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="item, stat : ${list}">
                            <td><input name="chkTopic" th:value="${item.tpicUid}" type="checkbox" title="선택"></td>
                            <td th:text="${stat.count}">1</td>
                            <td th:text="${item.tpicGbCdNm}">토픽구분명</td>
                            <td th:text="${item.tpicMnuCdNm}">토픽메뉴명</td>
                            <td><a href="javascript:void(0);"
                                   th:onclick="fnTopicRegistViewPop([[${item.tpicUid}]]);" class="link"
                                   th:text="${item.tpicNm}"></a></td>
                            <td th:text="${item.rlsTgtCdNms}">그룹A,그룹B</td>
                            <td th:text="${item.dpSttEndDtm}">기간from-to</td>
                            <td th:text="${item.useYnNm}">사용</td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(list)}">
                            <td class="nodata" colspan="8">데이터가 존재하지 않습니다.</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <!-- //table-wrap -->
            </div>
            <!-- //result-list -->
        </section>
        <!-- //content -->
    </form>

    <!-- 토픽 등록 popup fragment-->
    <th:block
            th:replace="/sems/contents/topic/topicUpsertPop :: fragmentByTopicPop"></th:block>

</div>
<!-- layout:fragment -->
</html>
