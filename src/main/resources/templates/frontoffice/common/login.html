<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{frontoffice/layout/subwrapLayout}">

<th:block layout:fragment="script">
	<script type="text/javascript">
		$(function(){
			// 이벤트 설정
			$("#btnLogin").bind("click", fnLogin);	//로그인

			$("#mbrId, #mbrPwd").on("keydown", function (key) {
				if (key.keyCode == 13) {//키가 13이면 실행 (엔터는 13)
					fnLogin();
				}
			})

			fnInit();
		});

		function fnLogin(){
			var formData, param = {};
			formData = _formLib.getFormData("loginFrm");

			param = {
				"url" : "/common/signUp"
				, "type" : "post"
				, "data" : formData
				, "async" : false
				, "callback" : function(data) {
					frm_check();
					if(data.msg == "success"){
						var rqtUri = data.rqtUri;
						if(rqtUri!=null && rqtUri!=''){
							window.location.href = rqtUri;
						}else{
							window.location.href = "/";
						}
					}else{
						alert(data.msg);
					}
				}
			};
			_comLib.callAjax(param);
		}

		function frm_check(){
	         saveid();
	     }

	    function fnInit(){
	        var cookieid = getCookie("saveid");
	        console.log(cookieid);
	        if(cookieid !=""){
	        	$('#saveId').prop("checked", true);
	            $('#mbrId').val(cookieid);
	        }

	    }

	    function setCookie(name, value, expiredays) {
	        var todayDate = new Date();
	        todayDate.setTime(todayDate.getTime() + 0);
	        if(todayDate > expiredays){
	            document.cookie = name + "=" + escape(value) + "; path=/; expires=" + expiredays + ";";
	        }else if(todayDate < expiredays){
	            todayDate.setDate(todayDate.getDate() + expiredays);
	            document.cookie = name + "=" + escape(value) + "; path=/; expires=" + todayDate.toGMTString() + ";";
	        }
	        console.log(document.cookie);
	    }

	    function getCookie(Name) {
	        var search = Name + "=";
	        console.log("search : " + search);

	        if (document.cookie.length > 0) { // 쿠키가 설정되어 있다면
	            offset = document.cookie.indexOf(search);
	            console.log("offset : " + offset);
	            if (offset != -1) { // 쿠키가 존재하면
	                offset += search.length;
	                // set index of beginning of value
	                end = document.cookie.indexOf(";", offset);
	                console.log("end : " + end);
	                // 쿠키 값의 마지막 위치 인덱스 번호 설정
	                if (end == -1)
	                    end = document.cookie.length;
	                console.log("end위치  : " + end);

	                return unescape(document.cookie.substring(offset, end));
	            }
	        }
	        return "";
	    }

	    function saveid() {
	        var expdate = new Date();
	        if ($("#saveId").is(":checked")){
	            expdate.setTime(expdate.getTime() + 1000 * 3600 * 24 * 30);
	            setCookie("saveid", $("#mbrId").val(), expdate);
	            }else{
	           expdate.setTime(expdate.getTime() - 1000 * 3600 * 24 * 30);
	            setCookie("saveid", $("#mbrId").val(), expdate);

	        }
	    }
	</script>
</th:block>

<div layout:fragment="content">
	<form id="loginFrm">

            <!-- content -->
            <div class="content">
                <section class="member-wrap">
                    <h3 class="tit">로그인</h3>
                    <form action="">
                        <fieldset>
                            <legend>로그인</legend>
                            <ul class="login-area">
                                <li>
                                    <input type="text" id="mbrId" name="mbrId" title="아이디" value="" placeholder="아이디를 입력해주세요">
                                </li>
                                <li>
                                    <input type="password" id="mbrPwd" name="mbrPwd" title="비밀번호" value="" placeholder="비밀번호를 입력해주세요">
                                </li>
                            </ul>
                            <div class="login-save">
                                <div class="checkbox-wrap">
                                    <input type="checkbox" id="saveId">
                                    <label for="saveId"><span>아이디 저장</span></label>
                                </div>
                            </div>
                            <div class="btn-wrap">
                                <button type="button" id="btnLogin" class="btn-primary"><span>로그인하기</span></button>
                            </div>
                            <div class="flex login-link">
                                <a href="/common/findMe">아이디 &middot; 비밀번호 찾기</a>
                                <a href="/common/join">회원가입하기</a>
                            </div>
                        </fieldset>
                    </form>
                </section>
                <!-- //member-wrap -->
            </div>
            <!-- //content -->

	</form>
</div>
</html>